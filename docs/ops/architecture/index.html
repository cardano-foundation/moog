<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-ops/architecture" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Architecture Overview | Moog</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://cardano-foundation.github.io/moog/img/anti-cli-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://cardano-foundation.github.io/moog/img/anti-cli-social-card.jpg"><meta data-rh="true" property="og:url" content="https://cardano-foundation.github.io/moog/docs/ops/architecture"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Architecture Overview | Moog"><meta data-rh="true" name="description" content="This document provides an overview of the architecture of the Antithesis CLI tool, which is designed to administer Antithesis tests execution through Cardano."><meta data-rh="true" property="og:description" content="This document provides an overview of the architecture of the Antithesis CLI tool, which is designed to administer Antithesis tests execution through Cardano."><link data-rh="true" rel="icon" href="/moog/img/cardano-ada-logo.svg"><link data-rh="true" rel="canonical" href="https://cardano-foundation.github.io/moog/docs/ops/architecture"><link data-rh="true" rel="alternate" href="https://cardano-foundation.github.io/moog/docs/ops/architecture" hreflang="en"><link data-rh="true" rel="alternate" href="https://cardano-foundation.github.io/moog/docs/ops/architecture" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/moog/blog/rss.xml" title="Moog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/moog/blog/atom.xml" title="Moog Atom Feed">





<link rel="stylesheet" href="https://unpkg.com/asciinema-player@3.0.0/dist/bundle/asciinema-player.min.css"><link rel="stylesheet" href="/moog/assets/css/styles.fef8902e.css">
<script src="/moog/assets/js/runtime~main.a8b8e982.js" defer="defer"></script>
<script src="/moog/assets/js/main.d5deda83.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><link rel="preload" as="image" href="/moog/img/cardano-ada-logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#ff9999;color:#091E42" role="banner"><div class="content_knG7 announcementBarContent_xLdY"><strong>Moog is still at an early stage and experimental. Contributions and ideas are <a target="_blank" rel="noopener noreferrer" href="https://github.com/cardano-foundation/moog/">most welcome</a></strong></div></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/moog/"><div class="navbar__logo"><img src="/moog/img/cardano-ada-logo.svg" alt="Cardano Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/moog/img/cardano-ada-logo.svg" alt="Cardano Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Moog</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/moog/docs/overview">Documentation</a><a class="navbar__item navbar__link" href="/moog/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/cardano-foundation/moog" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/moog/docs/overview">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/moog/docs/user/intro">User Manual</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/moog/docs/ops/intro">Operations Manual</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/moog/docs/ops/intro">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/moog/docs/ops/architecture">Architecture Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/moog/docs/ops/protocol">Moog Protocol</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/moog/docs/ops/oracle-role">Oracle role manual</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/moog/docs/ops/agent-role">Agent role manual</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/moog/docs/ops/real-world">Real-World Scenario</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/moog/docs/ops/security">Security Considerations</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/moog/docs/ops/architecture">Developers</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/moog/docs/ops/architecture">Architecture Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/moog/docs/dev/code-design">Code Design Decisions</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/moog/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Operations Manual</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Architecture Overview</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Architecture Overview</h1></header>
<p>This document provides an overview of the architecture of the Antithesis CLI tool, which is designed to administer Antithesis tests execution through Cardano.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="decentralization-model">Decentralization model<a href="#decentralization-model" class="hash-link" aria-label="Direct link to Decentralization model" title="Direct link to Decentralization model">​</a></h2>
<p>The Antithesis CLI tool operates within a decentralized framework, leveraging blockchain technology to ensure transparency, security, and immutability of test execution records.</p>
<p>First-class participation would imply access to a Cardano node. However, the system is designed to separate blockchain interaction from test execution management, allowing the backend service to run separately, next to the Cardano node.</p>
<p>To improve component reusability, the backend service has no knowledge of project-specific goals and is developed in a separate repository: <a href="https://github.com/cardano-foundation/MPFS" target="_blank" rel="noopener noreferrer">MPFS</a>.</p>
<p>In a perfect setup, each actor should run both the CLI tool and the MPFS service locally. However, for practical reasons, we expect most users to run only the CLI tool while relying on remote shared instances of the MPFS service. <a href="/moog/docs/ops/security">Security considerations</a> should be taken into account when choosing between local or shared MPFS service instances.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="systems">Systems<a href="#systems" class="hash-link" aria-label="Direct link to Systems" title="Direct link to Systems">​</a></h2>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="github-platform">GitHub Platform<a href="#github-platform" class="hash-link" aria-label="Direct link to GitHub Platform" title="Direct link to GitHub Platform">​</a></h3>
<p>We use GitHub services to manage user identities, roles, and per-repository test assets hosting.</p>
<!-- -->
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="github-as-identity-provider">GitHub as identity provider<a href="#github-as-identity-provider" class="hash-link" aria-label="Direct link to GitHub as identity provider" title="Direct link to GitHub as identity provider">​</a></h4>
<p>Any GitHub user can register themselves against the system state by deploying a file containing a Cardano public key in their personal GitHub repository.</p>
<ul>
<li>GitHub docs: <a href="https://docs.github.com/en/account-and-profile/how-tos/profile-customization/managing-your-profile-readme" target="_blank" rel="noopener noreferrer">profile repository</a>.</li>
<li>Example: <a href="https://github.com/cfhal/cfhal/blob/main/moog-cli.vkey" target="_blank" rel="noopener noreferrer">moog-cli.vkey</a>.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="github-as-antithesis-role-management">Github as Antithesis role management<a href="#github-as-antithesis-role-management" class="hash-link" aria-label="Direct link to Github as Antithesis role management" title="Direct link to Github as Antithesis role management">​</a></h4>
<p>To grant the Antithesis tester role, a GitHub repository must explicitly list GitHub users in its CODEOWNERS file; the system uses this mapping to determine which users are authorized as testers for that repository.</p>
<ul>
<li>Example: <a href="https://github.com/cardano-foundation/moog/blob/main/CODEOWNERS" target="_blank" rel="noopener noreferrer">CODEOWNERS</a></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="github-as-test-assets-hosting">Github as test assets hosting<a href="#github-as-test-assets-hosting" class="hash-link" aria-label="Direct link to Github as test assets hosting" title="Direct link to Github as test assets hosting">​</a></h4>
<p>Any GitHub repository that has been registered with the system (i.e., contains a valid user public key and is whitelisted for test execution) can host a directory containing test definitions that meet the required format and standards. Currently only a runnable docker-compose.yaml is required.</p>
<ul>
<li>Example: <a href="https://github.com/cardano-foundation/moog/tree/main/compose/testnets/cardano_node_master" target="_blank" rel="noopener noreferrer">test definition</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="antithesis-platform">Antithesis Platform<a href="#antithesis-platform" class="hash-link" aria-label="Direct link to Antithesis Platform" title="Direct link to Antithesis Platform">​</a></h3>
<!-- -->
<p>Antithesis is the test execution platform that provides the infrastructure to run tests and collect results. Currently we use a POST API to create test runs and fetch results via email parsing. In the future the platform will provide a better API to manage test runs and fetch results.</p>
<ul>
<li>Antithesis docs: <a href="https://antithesis.com/docs/webhook/test_webhook/" target="_blank" rel="noopener noreferrer">API</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cardano-blockchain">Cardano Blockchain<a href="#cardano-blockchain" class="hash-link" aria-label="Direct link to Cardano Blockchain" title="Direct link to Cardano Blockchain">​</a></h3>
<!-- -->
<p>The blockchain will store data and certifications for</p>
<ul>
<li>GitHub user and their associated Cardano public keys.</li>
<li>GitHub roles such as repository testers by Antithesis.</li>
<li>Repository whitelisting for test execution.</li>
<li>Oracle validation configuration.</li>
<li>Record of each test execution requests and (link to their) results.</li>
</ul>
<p>The cryptographic aspects of the system are defined by the use of an underlying MPFS system as intermediary between the CLI tool and the blockchain.</p>
<p>This choice enforce a strict protocol that ensures</p>
<ul>
<li>Any system fact is always certified on-chain (merkle root).</li>
<li>All and only of the system state transitions have been recorded in the merkle tree have been spent and validated on-chain.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="mpfs-service-instances">MPFS Service instances.<a href="#mpfs-service-instances" class="hash-link" aria-label="Direct link to MPFS Service instances." title="Direct link to MPFS Service instances.">​</a></h3>
<!-- -->
<p>The MPFS Service is a backend system that all actors will use to interact with the blockchain in a way independent from the application logic.</p>
<p>It exposes a REST API to be used by the CLI tool.</p>
<p>The system is capable of producing unsigned transactions for the system users, submitting signed transactions to the blockchain, and most importantly providing the current system state, cryptographically certified and stored on-chain.</p>
<p>We borrow many concepts and much terminology from the MPFS project. In particular the system state is referred to as <strong>facts</strong>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="moog-cli-tool-and-automations">Moog CLI Tool (and automations)<a href="#moog-cli-tool-and-automations" class="hash-link" aria-label="Direct link to Moog CLI Tool (and automations)" title="Direct link to Moog CLI Tool (and automations)">​</a></h3>
<!-- -->
<p>This is the command line interface that users will use to interact with the MPFS service and GitHub and manage their test executions on Antithesis.
With it users can:</p>
<ul>
<li>Browse the system state querying the MPFS service for facts (as any role).</li>
<li>Issue and validate requests to update the system state via Cardano transactions (as requester or agent).</li>
<li>Interact with GitHub to validate requests against the system state (as requester or agent).</li>
<li>Interact with Antithesis API to create test runs and collect results (as agent).</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="roles">Roles<a href="#roles" class="hash-link" aria-label="Direct link to Roles" title="Direct link to Roles">​</a></h2>
<p>The CLI tool, along with its built-in automation features for test execution and state management, supports the following roles: requester, agent, and oracle.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="requester-role">Requester role<a href="#requester-role" class="hash-link" aria-label="Direct link to Requester role" title="Direct link to Requester role">​</a></h3>
<!-- -->
<p>A GitHub user who initiates test execution requests on the Antithesis platform.</p>
<p>The <code>requester</code> role involves no automation; users interact exclusively through the CLI tool to act as a requester.</p>
<p>They use the CLI tool to submit administrative requests (such as user and role registration) and test requests (such as creating test runs), interacting with the MPFS service and GitHub to validate their actions against the current system state.</p>
<p>The <code>requester</code> role is fully manual, requiring users to perform all actions through the CLI tool without automation.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="agent-role">Agent role<a href="#agent-role" class="hash-link" aria-label="Direct link to Agent role" title="Direct link to Agent role">​</a></h3>
<!-- -->
<p>A user who interacts with both the Antithesis API and the MPFS service, responsible for automating the execution of tests on the Antithesis platform and collecting results, while also managing relevant state changes and validations.</p>
<p>The <code>agent</code> role is partially automated and so an executable and docker image is provided to run it as a service; however, the agent must manually <code>whitelist</code> repositories using the CLI tool before the oracle can validate test execution requests from those repositories.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="oracle-role">Oracle role<a href="#oracle-role" class="hash-link" aria-label="Direct link to Oracle role" title="Direct link to Oracle role">​</a></h3>
<!-- -->
<p>A trusted user that manages and maintains authority over the system state, validates requests from the other roles, and updates the state of the system on the blockchain.
The <code>oracle</code> role is fully automated; an executable and Docker image are provided to run it as a service.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="mpfs-derived-concepts">MPFS derived concepts<a href="#mpfs-derived-concepts" class="hash-link" aria-label="Direct link to MPFS derived concepts" title="Direct link to MPFS derived concepts">​</a></h2>
<p>The use of MPFS imposes a strict protocol and terminology to describe the interactions between the different roles.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="state-token">State token<a href="#state-token" class="hash-link" aria-label="Direct link to State token" title="Direct link to State token">​</a></h3>
<!-- -->
<p>The MPFS is a multi-project token centric system, meaning that each project&#x27;s state and identity are managed through unique tokens on the Cardano blockchain.</p>
<p>Each project is represented by a unique asset, but they all share the same MPFS policy id. The policy id imposes a minting policy that ensures the merkle tree is empty at the beginning of time and that the asset is unique on the blockchain.</p>
<p>The MPFS policy id is also the script address where each project token is caged into. The script is responsible for enforcing the MPFS protocol on all MPFS tokens.</p>
<p>Each state token holds the system state as a <code>merkle root</code> in a UTxO datum. The smart contract script enforces that any state transition must consume the current state token and produce a new state token with an updated merkle root and put it back at the same script address.</p>
<p>Only the <code>oracle</code> role is allowed to update (consume) the state token and put back a new version of it with an updated state.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="state-change-requests">State change requests<a href="#state-change-requests" class="hash-link" aria-label="Direct link to State change requests" title="Direct link to State change requests">​</a></h3>
<!-- -->
<p><code>requester</code> and <code>agent</code> roles are both seen as users from the MPFS perspective. They interact with the system by issuing state change requests.</p>
<p>State change requests appears on chain as UTxO datums locked at the MPFS script address.
They contain proposed changes in the form of deltas to be applied to the current system state.
They also contain the asset id of the project token they are targeting.</p>
<p>The smart contract script enforces that they are only consumed by the <code>oracle</code> role when updating the system state.</p>
<p>A broad classification of change requests for our project is:</p>
<ul>
<li>Requester role:<!-- -->
<ul>
<li>Administrative requests: used to register users and roles (a.k.a. repositories)</li>
<li>Test requests: used to create test runs</li>
</ul>
</li>
<li>Agent role:<!-- -->
<ul>
<li>Administrative requests: used to whitelist repositories</li>
<li>Test requests: used to accept/reject test runs and update test results</li>
</ul>
</li>
<li>Oracle role:<!-- -->
<ul>
<li>The oracle role exceptionally behave as a user when it publishes its own configuration on-chain.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="state-updates">State updates<a href="#state-updates" class="hash-link" aria-label="Direct link to State updates" title="Direct link to State updates">​</a></h3>
<p>The <code>oracle</code> role as seen from the MPFS perspective is the guardian of the system state.</p>
<p>As an MPFS oracle it is responsible for</p>
<ul>
<li>Creating the project token in the MPFS</li>
<li>Updating the token state based on the change requests issued by the other roles.</li>
</ul>
<p>As the guardian of the state it has the responsibility to validate the change requests and prevent inconsistent data to enter/exit the token.
Typical validations on requests performed by the oracle are:</p>
<ul>
<li>Validating GitHub credentials and roles. This is really post-oracle-ing GitHub.</li>
<li>Validating digital signatures on requests. Only registered users are allowed to start new tests.</li>
<li>Validating repository whitelisting for test execution. Only tests for whitelisted repositories are allowed.</li>
<li>Validating the identity of the <code>agent</code> role when it comes to modify the tests state.</li>
<li>Validating the test parameters (e.g. platform, repository, commit, etc.) at test creation time.</li>
<li>Validating the tests state transitions respect semantic consistency. Every test state is modelled as a finite state machine and the oracle ensures that only valid transitions are allowed.</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/cardano-foundation/moog/tree/main/docs/docs/ops/architecture.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/moog/docs/ops/intro"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Introduction</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/moog/docs/ops/protocol"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Moog Protocol</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#decentralization-model" class="table-of-contents__link toc-highlight">Decentralization model</a></li><li><a href="#systems" class="table-of-contents__link toc-highlight">Systems</a><ul><li><a href="#github-platform" class="table-of-contents__link toc-highlight">GitHub Platform</a></li><li><a href="#antithesis-platform" class="table-of-contents__link toc-highlight">Antithesis Platform</a></li><li><a href="#cardano-blockchain" class="table-of-contents__link toc-highlight">Cardano Blockchain</a></li><li><a href="#mpfs-service-instances" class="table-of-contents__link toc-highlight">MPFS Service instances.</a></li><li><a href="#moog-cli-tool-and-automations" class="table-of-contents__link toc-highlight">Moog CLI Tool (and automations)</a></li></ul></li><li><a href="#roles" class="table-of-contents__link toc-highlight">Roles</a><ul><li><a href="#requester-role" class="table-of-contents__link toc-highlight">Requester role</a></li><li><a href="#agent-role" class="table-of-contents__link toc-highlight">Agent role</a></li><li><a href="#oracle-role" class="table-of-contents__link toc-highlight">Oracle role</a></li></ul></li><li><a href="#mpfs-derived-concepts" class="table-of-contents__link toc-highlight">MPFS derived concepts</a><ul><li><a href="#state-token" class="table-of-contents__link toc-highlight">State token</a></li><li><a href="#state-change-requests" class="table-of-contents__link toc-highlight">State change requests</a></li><li><a href="#state-updates" class="table-of-contents__link toc-highlight">State updates</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/moog/docs/overview">Getting Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/quVqGUrW" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/moog/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/cardano-foundation/moog" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Cardano Foundation, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>